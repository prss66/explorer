<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en" ng-app="ethExplorer" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en" ng-app="ethExplorer" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en" ng-app="ethExplorer" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en" ng-app="ethExplorer" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>æç»§å¤çš„åŒºå—é“¾æµè§ˆå™¨</title>
  <meta name="description" content="åŸºäºEtherparty Explorerçš„ä¸ªæ€§åŒ–åŒºå—æµè§ˆå™¨,æ”¯æŒæœ¬åœ°GethèŠ‚ç‚¹è¿æ¥">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="bower_components/web3/dist/web3.min.js"></script>

</head>
<body>
  
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <span class="icon-bar"></span><a href="/#/" class="navbar-brand">ğŸ” æˆ‘çš„åŒºå—é“¾æµè§ˆå™¨</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
            <form  name="search_form" ng-controller="mainCtrl" ng-submit="processRequest()"  class="navbar-form navbar-right">
            <div class="form-group">
            <input type="text" placeholder="è¯·è¾“å…¥äº¤æ˜“å“ˆå¸Œã€åœ°å€æˆ–åŒºå—å·" name="requestType" required  ng-model="ethRequest"  class="form-control"><br>
            </div>
            <button type="submit" class="btn btn-success">æœç´¢</button></form>
            </ul>
	    </div>
    </div>
</nav>



  <div ng-view></div>

<!--Libs-->

  <script src="https://cdn.bootcdn.net/ajax/libs/angular.js/1.4.5/angular.min.js"></script>
  <script src="bower_components/angular-bootstrap/ui-bootstrap.min.js"></script>
  <script src="bower_components/angular-route/angular-route.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<!--Core-->
  <script src="app.js"></script>

<!--Controllers-->
  <script src="scripts/controllers/mainController.js"></script>
  <script src="scripts/controllers/addressInfoController.js"></script>
  <script src="scripts/controllers/blockInfosController.js"></script>
  <script src="scripts/controllers/transactionInfosController.js"></script>

  <!--Services-->
    <div id="connectwarning" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <center><div class="modal-header">
                    <h4 class="modal-title">è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹</h4>
                </div>
                <div class="modal-body">
                    <code><p id="modaltext"></p></code>
                </div></center>
            </div>
        </div>
    </div>


<div class="footer" style="bottom: 0px;text-align: center;background-color: rgb(237, 97, 158); width:100%; padding: 20px 0; border-top: 1px solid #e7e7e7;">
    <footer>
        <div class="container">
            <p>
                Â© 2025 åŒºå—é“¾æŠ€æœ¯å®è®­é¡¹ç›® | 
                å¼€å‘è€…ï¼šæç»§å¤ | 
                æŒ‡å¯¼è€å¸ˆï¼šæŸæŸæŸ | 
                åŸºäº <a href="http://github.com/etherparty/explorer" target="_blank">Etherparty Explorer</a>
            </p>
            <p style="color: #666; font-size: 12px; margin-top: 5px;">
                æ”¯æŒæœ¬åœ°GethèŠ‚ç‚¹è¿æ¥ | ç½‘ç»œID: 202406 | 
                æœ€åæ›´æ–°:
                <script>
                (function() {
                    var d = new Date();
                    var timeStr = d.getFullYear() + '-' + 
                         (d.getMonth()+1).toString().padStart(2,'0') + '-' + 
                         d.getDate().toString().padStart(2,'0') + ' ' + 
                         d.getHours().toString().padStart(2,'0') + ':' + 
                         d.getMinutes().toString().padStart(2,'0');
            document.write(timeStr);
        })();
    </script> 
            </p>
        </div>
    </footer>
</div>
<script>
// è‡ªåŠ¨è¿æ¥è„šæœ¬
$(document).ready(function() {
    // æ˜¾ç¤ºåˆé€‚çš„Gethå‘½ä»¤
    $("#modaltext").text('geth --http --http.port 8545 --http.corsdomain "*" --http.api "eth,net,web3,personal"');
    
    // è‡ªåŠ¨å°è¯•è¿æ¥
    setTimeout(connectToLocalGeth, 1000);
});

function connectToLocalGeth() {
    console.log('æ­£åœ¨è¿æ¥åˆ°æœ¬åœ°GethèŠ‚ç‚¹...');
    
    try {
        var web3 = new Web3('http://localhost:8545');
        
        // æµ‹è¯•è¿æ¥
        web3.eth.getBlockNumber(function(err, blockNumber) {
            if (err) {
                console.error('è¿æ¥å¤±è´¥:', err);
                $('#status-text').text('âŒ è¿æ¥å¤±è´¥');
                $('#error-message').text('é”™è¯¯: ' + err.message).show();
                $('#connectwarning').modal('show');
            } else {
                console.log('âœ… è¿æ¥æˆåŠŸ! å½“å‰åŒºå—:', blockNumber);
                $('#status-text').text('âœ… å·²è¿æ¥åˆ°æœ¬åœ°GethèŠ‚ç‚¹');
                $('#error-message').hide();
                
                // è®¾ç½®å…¨å±€web3
                window.web3 = web3;
                
                // 3ç§’åè‡ªåŠ¨éšè—æ¨¡æ€æ¡†
                setTimeout(function() {
                    $('#connectwarning').modal('hide');
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showSuccessMessage('å·²è¿æ¥åˆ°Geth,å½“å‰åŒºå—: ' + blockNumber);
                    
                    // æ›´æ–°é¡µé¢çŠ¶æ€
                    updatePageStatus(blockNumber);
                }, 3000);
            }
        });
    } catch (error) {
        console.error('Web3åˆå§‹åŒ–é”™è¯¯:', error);
        $('#status-text').text('âŒ Web3åˆå§‹åŒ–å¤±è´¥');
        $('#error-message').text('é”™è¯¯: ' + error.message).show();
        $('#connectwarning').modal('show');
    }
}

function retryConnection() {
    $('#status-text').text('é‡æ–°è¿æ¥ä¸­...');
    $('#error-message').hide();
    connectToLocalGeth();
}

function showSuccessMessage(message) {
    var msgDiv = $('<div/>', {
        id: 'success-message',
        css: {
            position: 'fixed',
            top: '20px',
            right: '20px',
            background: '#4CAF50',
            color: 'white',
            padding: '15px',
            borderRadius: '5px',
            zIndex: '10000',
            boxShadow: '0 4px 12px rgba(0,0,0,0.15)'
        },
        html: '<strong>âœ… è¿æ¥æˆåŠŸ</strong><br>' + message
    });
    
    $('body').append(msgDiv);
    
    setTimeout(function() {
        msgDiv.fadeOut(500, function() {
            $(this).remove();
        });
    }, 5000);
}

function updatePageStatus(blockNumber) {
    // åœ¨å¯¼èˆªæ æ·»åŠ çŠ¶æ€æ˜¾ç¤º
    var statusHtml = '<div class="navbar-text" style="margin-left: 20px;">' +
                     '<span style="color: #4CAF50;">ğŸŸ¢ å·²è¿æ¥</span>' +
                     '<span style="margin-left: 15px; color: #666;">åŒºå—: ' + blockNumber + '</span>' +
                     '</div>';
    
    // å¦‚æœå·²æœ‰çŠ¶æ€æ˜¾ç¤ºï¼Œæ›´æ–°å®ƒï¼›å¦åˆ™æ·»åŠ æ–°çš„
    var existingStatus = $('.navbar-text:contains("å·²è¿æ¥")');
    if (existingStatus.length) {
        existingStatus.html('<span style="color: #4CAF50;">ğŸŸ¢ å·²è¿æ¥</span>' +
                          '<span style="margin-left: 15px; color: #666;">åŒºå—: ' + blockNumber + '</span>');
    } else {
        $('.navbar-collapse').append(statusHtml);
    }
}

// å®šæœŸæ£€æŸ¥è¿æ¥çŠ¶æ€
setInterval(function() {
    if (window.web3 && window.web3.eth) {
        window.web3.eth.getBlockNumber(function(err, blockNumber) {
            if (!err) {
                updatePageStatus(blockNumber);
            }
        });
    }
}, 10000);
</script>
</body>
</html>
